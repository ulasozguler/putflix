(this.webpackJsonpputflix=this.webpackJsonpputflix||[]).push([[0],{101:function(e,t,i){"use strict";i.r(t);var n=i(1),a=i(0),s=i(21),r=i(13),o=i(45),c=i(15),l={FETCH_USER:"FETCH_USER",FETCH_FILE:"FETCH_FILE",FETCH_VIDEO:"FETCH_VIDEO",CLEAR_VIDEO:"CLEAR_VIDEO"},d={loading:!0,data:{}},h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case l.FETCH_USER:return t.payload;default:return e}},u=i(17),p=i(14),f={},v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case l.FETCH_FILE:return Object(p.a)(Object(p.a)({},e),{},Object(u.a)({},t.payload.fileId,Object(p.a)(Object(p.a)({},t.payload.data.parent),{},{files:t.payload.data.files,file_count:t.payload.data.total})));default:return e}},j={},b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:j,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case l.FETCH_VIDEO:return Object(p.a)(Object(p.a)({},e),{},Object(u.a)({},t.payload.id,t.payload));case l.CLEAR_VIDEO:return{};default:return e}},m=Object(c.c)({user:h,file:v,video:b}),g=Object(c.d)(m,Object(c.a)(o.a)),O=(i(61),i(8)),y=i(9),_=i(12),x=i(11),k=i(19),C="4924",E="https://app.put.io/files/",F="putflix-folder";var I=function(e){return e.user.loading?Object(n.jsx)("div",{id:"userBox",children:"Loading..."}):Object(n.jsxs)("div",{id:"userBox",children:[e.user.data.username,Object(n.jsx)(k.b,{className:"link",to:"/settings",children:"Settings"}),Object(n.jsx)("span",{className:"link",onClick:function(){var e=localStorage.getItem(F);localStorage.clear(),localStorage.setItem(F,e),window.location.href="/"},children:"Logout"})]})},w=i(51),S=new(i(46).a)({clientID:C});S.recursiveVideos=function(e,t){var i=this;this.Files.Query(e).then((function(e){var n=e.data.parent.file_type;if("FOLDER"===n){var a,s=Object(w.a)(e.data.files);try{for(s.s();!(a=s.n()).done;){var r=a.value;i.recursiveVideos(r.id,t)}}catch(o){s.e(o)}finally{s.f()}}else"VIDEO"===n&&t(e.data.parent)}))}.bind(S);var T=S;function D(e,t){return{type:l.FETCH_FILE,payload:{fileId:e,data:t}}}function L(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=1024,n=["B","KB","MB","GB","TB","PB"];if(0===e)return"empty";if(Math.abs(e)<i)return e+n[0];var a=0,s=Math.pow(10,t);do{e/=i,++a}while(Math.round(Math.abs(e)*s)/s>=i&&a<n.length-1);return e.toFixed(t)+n[a]}var N=function(e){Object(_.a)(i,e);var t=Object(x.a)(i);function i(e){var n;return Object(O.a)(this,i),(n=t.call(this,e)).file=n.props.file,n.isExpanded=!1,n.file||(n.file={id:0,file_type:"FOLDER",name:"Your Files"}),n}return Object(y.a)(i,[{key:"isFolder",value:function(){return"FOLDER"===this.file.file_type}},{key:"isRoot",value:function(){return 0===this.file.id}},{key:"isExpandable",value:function(){return this.isFolder()&&!this.isRoot()}},{key:"shouldFetchChildren",value:function(){return this.isFolder()&&0!==this.file.size&&0===this.getChildren().length}},{key:"expandFolder",value:function(){this.shouldFetchChildren()?(this.props.fetchFile(this.file.id,this.props.config),this.isExpanded=!0):(this.isExpanded=!this.isExpanded,this.forceUpdate())}},{key:"clickHandler",value:function(e){this.isFolder()&&this.expandFolder(),e.stopPropagation()}},{key:"getChildren",value:function(){var e=[];return this.props.data[this.file.id]&&(e=this.props.data[this.file.id].files),e}},{key:"selectionHandler",value:function(e){this.props.selectHandler&&(this.props.clearVideoData(),this.props.selectHandler(this.file)),e.stopPropagation()}},{key:"render",value:function(){var e=this;return this.isRoot()&&!this.isExpanded&&this.expandFolder(),Object(n.jsxs)("div",{className:"folder",onClick:this.clickHandler.bind(this),children:[Object(n.jsxs)("div",{className:"name"+(this.isExpandable()&&" clickable"),children:[Object(n.jsx)("span",{className:"selector",onClick:this.selectionHandler.bind(this),children:this.props.selectedId===this.file.id.toString()?"[Selected]":"[Select]"}),this.file.name,!this.isRoot()&&Object(n.jsxs)("span",{className:"fileSize",children:["(",L(this.file.size),")"]})]}),this.isExpanded&&Object(n.jsx)("div",{className:"children",children:this.getChildren().map((function(t){return Object(n.jsx)(U,{file:t,config:e.props.config,selectHandler:e.props.selectHandler,selectedId:e.props.selectedId},t.id)}))})]})}}]),i}(a.Component),H={fetchFile:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(i){return T.Files.Query(e,t).then((function(t){i(D(e,t.data))}))}},clearVideoData:function(){return{type:l.CLEAR_VIDEO}}},U=Object(r.b)((function(e){return{data:e.file}}),H)(N),V=U,R=function(e){Object(_.a)(i,e);var t=Object(x.a)(i);function i(){return Object(O.a)(this,i),t.apply(this,arguments)}return Object(y.a)(i,[{key:"getDefaultFolder",value:function(){return localStorage.getItem(F)}},{key:"selectHandler",value:function(e){localStorage.setItem(F,e.id),this.forceUpdate()}},{key:"render",value:function(){return Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)("h3",{children:"Select a folder to browse:"}),Object(n.jsx)(V,{config:{fileType:"FOLDER"},selectHandler:this.selectHandler.bind(this),selectedId:this.getDefaultFolder()})]})}}]),i}(a.Component);function M(e,t,i){t.api_key="0226d6c251ad9cbce59f3400d02d75d4",fetch("https://api.themoviedb.org/3/"+e+"?"+new URLSearchParams(t)).then((function(e){return e.json()})).then(i)}var P=function(e){Object(_.a)(i,e);var t=Object(x.a)(i);function i(e){var n;return Object(O.a)(this,i),(n=t.call(this,e)).movie={found:!1},n}return Object(y.a)(i,[{key:"toggleCast",value:function(){this.isCastVisible=!this.isCastVisible,this.forceUpdate()}},{key:"parseTitle",value:function(){for(var e=this.props.data.name,t=0,i=[".","(",")",":","1080p"];t<i.length;t++){var n=i[t];e=e.replaceAll(n," ")}var a=e.match(/(..*?)([0-9]{4})/gi);return!!a&&{title:a[0].trim().slice(0,-4).trim(),year:a[0].trim().slice(-4).trim()}}},{key:"applyCast",value:function(e){this.movie=Object.assign(this.movie,e),this.movie.done=!0,this.forceUpdate()}},{key:"applyMedia",value:function(e){var t,i;this.movie=Object.assign(this.movie,e),t=this.movie.id,i=this.applyCast.bind(this),M("movie/"+t+"/credits",{},i)}},{key:"applyTMDB",value:function(e){var t,i;e&&(e.found=!0,this.movie=Object.assign(this.movie,e),t=this.movie.id,i=this.applyMedia.bind(this),M("movie/"+t,{append_to_response:"videos"},i))}},{key:"componentDidMount",value:function(){var e,t,i;this.movie=this.parseTitle(),this.movie&&(e=this.movie.title,t=this.movie.year,i=this.applyTMDB.bind(this),M("search/movie",{query:e,year:t,include_adult:!1},(function(t){!function(e,t,i){if(1===t.total_results)return i(t.results[0]);e=e.toUpperCase();var n=t.results.filter((function(t){return t.title.toUpperCase()===e||t.original_title.toUpperCase()===e}));0===n.length?i(null):1===n.length?i(n[0]):i(n.reduce((function(e,t){return e.vote_count>t.vote_count?e:t})))}(e,t,i)})))}},{key:"render",value:function(){var e=this.props.data;if(!this.movie.found||!this.movie.done)return Object(n.jsx)("div",{className:"movie",children:Object(n.jsx)("h1",{children:Object(n.jsx)("a",{href:E+this.props.data.id,target:"_blank",rel:"noreferrer",children:e.name})})});var t="https://image.tmdb.org/t/p/w1280"+(this.movie.backdrop_path||this.movie.poster_path);return Object(n.jsxs)("div",{className:"movie",style:{backgroundImage:"url("+t+")"},children:[Object(n.jsxs)("h1",{children:[Object(n.jsxs)("a",{href:E+this.props.data.id,target:"_blank",rel:"noreferrer",children:[Object(n.jsxs)("span",{children:[this.movie.title," (",this.movie.year,")"]}),this.movie.title!==this.movie.original_title&&Object(n.jsx)("span",{className:"originalTitle",children:this.movie.original_title})]}),Object(n.jsx)("div",{className:"vote",children:Object(n.jsxs)("span",{children:["\u2605 ",this.movie.vote_average]})}),Object(n.jsx)("div",{className:"genres",children:this.movie.genres.map((function(e){return Object(n.jsx)("span",{className:"genre",children:e.name},e.id)}))})]}),Object(n.jsx)("img",{className:"poster",alt:this.movie.name+" Poster",src:"https://image.tmdb.org/t/p/w185"+this.movie.poster_path}),Object(n.jsx)("div",{className:"overview",children:Object(n.jsx)("span",{children:this.movie.overview})}),Object(n.jsxs)("div",{className:"links",children:[this.movie.videos.results.filter((function(e){return"Trailer"===e.type&&"YouTube"===e.site})).map((function(e){return Object(n.jsx)("a",{className:"youtube",href:"https://youtu.be/"+e.key,target:"_blank",rel:"noreferrer",children:Object(n.jsx)("img",{src:"https://www.youtube.com/about/static/svgs/icons/brand-resources/YouTube_icon_full-color.svg",alt:"Watch Trailer"})},e.id)})),this.movie.imdb_id&&Object(n.jsx)("a",{className:"imdb",href:"https://www.imdb.com/title/"+this.movie.imdb_id+"/",target:"_blank",rel:"noreferrer",children:Object(n.jsx)("img",{src:"https://m.media-amazon.com/images/G/01/IMDb/BG_rectangle._CB1509060989_SY230_SX307_AL_.png",alt:"View on IMDb"})})]}),Object(n.jsx)("div",{className:"clearfix"}),this.movie.cast.length>0&&Object(n.jsx)("div",{className:"cast"+(this.isCastVisible?" visible":""),children:this.movie.cast.slice(0,5).map((function(e){return Object(n.jsxs)("div",{className:"actor",children:[e.profile_path&&Object(n.jsx)("img",{src:"https://image.tmdb.org/t/p/w138_and_h175_face"+e.profile_path,alt:e.name}),e.name]},e.id)}))}),Object(n.jsx)("div",{className:"clearfix"}),this.movie.cast.length>0&&Object(n.jsx)("div",{className:"castToggle",onClick:this.toggleCast.bind(this),children:Object(n.jsxs)("span",{children:[this.isCastVisible?"\u21d1 Hide":"\u21d3 Show"," Cast"]})})]})}}]),i}(a.Component),B=function(e){Object(_.a)(i,e);var t=Object(x.a)(i);function i(){return Object(O.a)(this,i),t.apply(this,arguments)}return Object(y.a)(i,[{key:"componentDidMount",value:function(){this.props.fetchVideos(this.getDefaultFolderId())}},{key:"getDefaultFolderId",value:function(){return localStorage.getItem(F)}},{key:"getVideos",value:function(){return 0!==Object.keys(this.props.data).length&&(!!this.props.data&&Object.values(this.props.data).sort((function(e,t){return t.created_at.localeCompare(e.created_at)})))}},{key:"isFolderSet",value:function(){return!!localStorage.getItem(F)}},{key:"render",value:function(){if(!this.isFolderSet())return"Set folder in settings";var e=this.getVideos();return e?Object(n.jsx)("div",{id:"moviesWrapper",children:e.map((function(e){return Object(n.jsx)(P,{data:e},e.id)}))}):"Loading..."}}]),i}(a.Component),A={fetchVideos:function(e){return function(t){return T.recursiveVideos(e,(function(e){t(function(e){return{type:l.FETCH_VIDEO,payload:e}}(e))}))}}},z=Object(r.b)((function(e){return{data:e.video}}),A)(B),Y=i(3),G=function(e){Object(_.a)(i,e);var t=Object(x.a)(i);function i(){return Object(O.a)(this,i),t.apply(this,arguments)}return Object(y.a)(i,[{key:"componentDidMount",value:function(){this.props.fetchUser()}},{key:"render",value:function(){return Object(n.jsx)(k.a,{basename:"/",children:Object(n.jsxs)("div",{id:"App",children:[Object(n.jsxs)("div",{id:"header",children:[Object(n.jsx)(k.b,{to:"/",children:Object(n.jsx)("div",{id:"logo",className:"logoText logoLeft",children:"PUTFLIX"})}),Object(n.jsx)(I,{user:this.props.user})]}),Object(n.jsx)(Y.a,{exact:!0,path:"/",component:z}),Object(n.jsx)(Y.a,{exact:!0,path:"/settings",component:R})]})})}}]),i}(a.Component),X={fetchUser:function(){return function(e){return T.User.Info().then((function(t){var i;e((i=t.data.info,{type:l.FETCH_USER,payload:{data:i,loading:!1}}))}))}}},J=Object(r.b)((function(e){return{user:e.user}}),X)(G);var Q=function(e){return Object(n.jsxs)("div",{id:"home",children:[Object(n.jsx)("div",{id:"logo",className:"logoText",children:"PUTFLIX"}),"Putflix lists movies in your Put.io account with relevant information like plot and categories.",Object(n.jsx)("br",{}),Object(n.jsx)("a",{id:"connectPutio",href:e.authUrl,children:"Connect with Put.io"})]})},W=new(function(){function e(t){Object(O.a)(this,e),this.config=t,this._state_key="oauth2_state",this._access_token_key="oauth2_access_token"}return Object(y.a)(e,[{key:"isLoggedIn",value:function(){return localStorage.getItem(this._access_token_key)}},{key:"getToken",value:function(){return localStorage.getItem(this._access_token_key)}},{key:"_getState",value:function(){var e=localStorage.getItem(this._state_key);return null===e&&(e=Math.random().toString(32).substring(2),localStorage.setItem(this._state_key,e)),e}},{key:"getAuthUrl",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"token",t=new URLSearchParams({response_type:e,client_id:this.config.client_id,state:this._getState()});return this.config.auth_url+"?"+t.toString()}},{key:"handleCallback",value:function(e){if(null===new URLSearchParams(window.location.search).get("state"))return!1;var t=new URLSearchParams(window.location.hash).get("access_token");return localStorage.setItem(this._access_token_key,t),e(),!0}}]),e}())({client_id:C,auth_url:"https://api.put.io/v2/oauth2/authenticate"});W.isLoggedIn()&&T.setToken(W.getToken()),W.handleCallback((function(){return window.location.href="/"})),Object(s.render)(Object(n.jsx)(r.a,{store:g,children:W.isLoggedIn()?Object(n.jsx)(J,{}):Object(n.jsx)(Q,{authUrl:W.getAuthUrl()})}),document.getElementById("root"))},61:function(e,t,i){}},[[101,1,2]]]);
//# sourceMappingURL=main.99cea364.chunk.js.map